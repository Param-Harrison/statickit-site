import withDocs from '../../../components/with_docs';
import ArrowItem from '../../../components/arrow_item';

export default withDocs({
  title: 'Configuration',
  description: 'How to deploy StaticKit resources.',
  path: '/docs/configuration',
  toc: [
    [1, "Installation", "#installation"],
    [1, "Deployment", "#deployment"],
    [2, "ZEIT Now", "#zeit-now"]
  ],
  next: {
    path: '/docs/configuration/schema',
    label: 'Schema'
  }
});

# Configuration

StaticKit sites are configured with a `statickit.json` file and deployed via the command line. 

## Installation

To get started, install the CLI in your project:

```bash
npm i --save-dev @statickit/cli
```

[Source on GitHub](https://github.com/unstacked/statickit-cli) | [npm package](https://www.npmjs.com/package/@statickit/cli)

Then, create a `statickit.json` file in the root of your project. To provision forms, all you have to do is give them a name:

```js
{
  "forms": {
    "contact-form": {
      "name": "Contact Form"
    },
    "newsletter": {
      "name": "Newsletter Opt-In"
    }
  }
}
```

Later on when you wire up the front end, you'll reference your forms by the keys you chose â€” in this case, `contact-form` and `newsletter`.

Here's an example of a contact form with some field validation and actions:

```js
{
  "forms": {
    "contact": {
      "name": "Contact Form",
      "fields": {
        "email": {
          "type": "email",
          "prettyName": "Email address",
          "required": true
        },
        "message": {
          "type": "text",
          "prettyName": "Message",
          "required": true
        }
      },
      "actions": {
        "email": [{
          "to": "john@example.com" 
        }]
      }
    }
  }
}
```

<ArrowItem>
  <a href="/docs/configuration/schema" className="font-semibold text-indigo-600">Explore the complete schema docs</a>
</ArrowItem>

## Deployment

Once you have a `statickit.json` file ready, replace `<your-deploy-key>` with your actual key and run the following command:

```bash
npx statickit deploy -k <your-deploy-key>
```

The CLI will load environment variables from your project `.env` file (if one exists).

**Do not commit your `.env` file to version control.** Instead, add your deploy key to your build platform as a (secret) environment variable. Below are instructions on how to do this on commonly used platforms. 

### ZEIT Now

First, add your deploy key to your `now` secrets:

```bash
now secrets add statickit-deploy-key <your-deploy-key>
```

Then, in your `now.json` file, provide the build script with the environment variable:

```js
{
  "build": {
    "env": {
      "STATICKIT_DEPLOY_KEY": "@statickit-deploy-key"
    }
  }
}
```

Finally, add StaticKit deployment to your `now-build` script in `package.json`:

```diff
  {
    "scripts": {
-     "now-build": "your-build-script"
+     "now-build": "your-build-script && statickit deploy"
    }
  }
```
