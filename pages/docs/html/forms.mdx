import withDocs from '../../../components/with_docs';

export default withDocs({
  title: 'Forms - HTML Library',
  description: 'How to use the StaticKit form component.',
  path: '/docs/html/forms',
  breadcrumb: {
    path: '/docs/html',
    label: 'HTML Library',
    rel: 'prev'
  },
  toc: [
    [1, "Simple example", "#simple-example"],
    [1, "Handling success", "#handling-success"],
    [1, "Handling errors", "#handling-errors"],
    [1, "Configuration", "#configuration"],
    [2, "Required properties", "#required-properties"],
    [2, "Setting fields in code", "#setting-fields-in-code"],
    [2, "Customizing errors", "#customizing-errors"],
    [2, "Email properies", "#email-properties"],
    [2, "Error rendering", "#error-rendering"],
    [2, "Callbacks", "#callbacks"],
  ],
  prev: {
    path: '/docs/html',
    label: 'Installation'
  }
});

# Forms

Forms allow you to gather and store HTML `<form>` submissions with just a few lines of frontend code. For optimal user experience, StaticKit forms are powered by JavaScript (instead of the `action` attribute). This allows us to render inline validation errors, swap out the form with a success message upon submission, and provide lifecycle hooks for custom behavior. 

## Simple example

At a minimum, you just need a `<form>` element on your page and an `init` call. The following is a fully-functioning form that you can paste in your site. For the sake of simplicity, it is unstyled.

<div className="pb-6">
  <iframe width="100%" height="380" className="rounded-lg" src="//jsfiddle.net/StaticKit/8Lw6j75y/embedded/html,result/dark/" allowFullScreen="allowfullscreen" frameBorder="0"></iframe>
</div>

Notice there is no `action` attribute on the form. Under the covers, we listen for the `submit` event and post to our servers in the background. As a bonus, this makes your form less vulnerable to spam because there is no URL exposed in the markup.

Here's a prettier example of a contact form styled with Tailwind CSS.

<div className="pb-6">
  <iframe width="100%" height="400" className="rounded-lg" src="//jsfiddle.net/StaticKit/5Lks2b6m/embedded/result,html,js/dark/" allowFullScreen="allowfullscreen" frameBorder="0"></iframe>
</div>

## Handling success

The most common thing youâ€™ll want to customize what happens after the form is submitted. By default, we replace the `<form>` element with a plain thank you message:

```html
<div>Thank you!</div>
```

If you want to customize what gets replaced, you can implement your own `onSuccess` callback. Here's an example config that replaces the form with a custom message:

```js
sk('form', 'init', {
  onSuccess: function(config) {
    var h = config.h;
    var form = config.form;
    var replacement = h('div.success-message', 'Thank you for joining!');
    form.parentNode.replaceChild(replacement, form);
  },
  // ...
});
```

Let's step through what's happening here:

- `config.h` is a simple helper for constructing DOM nodes called [HyperScript](https://github.com/hyperhype/hyperscript)
- `config.form` is a reference to the `<form>` element
- `replacement` is a new `<div>` with a `success-message` class
- The last line replaces the form with the replacement element

If you want to redirect to a different page instead, you can do that like this:

```js
sk('form', 'init', {
  onSuccess: function(config) {
    window.location.href = '/thank-you';
  },
  // ...
});
```

## Handling errors

In many cases, [built-in HTML form validation](https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/Form_validation#Using_built-in_form_validation) (such as the `required` attribute) is sufficient to prevent invalid submissions. If it's critical that malformed submissions don't slip though, you can configure server-side validations in StaticKit.

When a server-side validation error occurs, the library will look for an element with a `data-sk-error` attribute and populate it with validation errors for the corresponding field:

```html
<form id="my-form">
  <!-- ... -->
  <div data-sk-error="email" class="error-message"></div>
  <!-- ... -->
</form>
```

You can override this default behavior by [implementing your own `renderErrors` function](#error-rendering).

## Configuration

Here are all the available configuration properties:

| Key                                | Description                                                        |
| :--------------------------------- | :----------------------------------------------------------------- |
| [`id`](#required-properties)       | The form ID                                                        |
| [`site`](#required-properties)     | The site ID                                                        |
| [`key`](#required-properties)      | The form key                                                       |
| [`element`](#required-properties)  | A DOM selector for your `<form>` or the actual form element        |
| [`data`](#setting-fields-in-code)  | An object containing additional form fields to send                |
| [`fields`](#customizing-errors)    | An object containing properties for specific fields                |
| [`on*`](#callbacks)                | Callbacks for various points in the lifecycle                      |
| [`renderErrors`](#error-rendering) | A function responsible for placing validation errors on the page   |

### Required properties

There are a few required properties:
- `id` or `site` + `key`
- `element`

For example:

```js
sk('form', 'init', {
  id: 'fcd6a6y7f5c2',
  element: '#my-form'
})
```

or

```js
sk('form', 'init', {
  site: 'v8jb8fd9fg9f',
  key: 'newsletter',
  element: '#my-form'
})
```

| Key                     | Type                     | Description                                                  |
| :---------------------- | :----------------------- | :----------------------------------------------------------- |
| `id`                    | String                   | The form ID                                                  |
| `site`                  | String                   | The site ID                                                  |
| `key`                   | String                   | The form key                                                 |
| `element`               | String or Element        | A DOM selector for your `<form>` or the actual form element  |

### Setting fields in code

To set fields programmatically, use the `data` object:

```js
sk('form', 'init', {
  data: {
    userAgent: navigator.userAgent
  },
  // ...
});
```

Values can either be static or functions (that will be evaluated at submission time):

```js
sk('form', 'init', {
  data: {
    pageTitle: function() {
      return document.title;
    }
  },
  // ...
});
```

### Customizing errors

Validation error messages read like this by default: **This field is required**. It gets the message across, but can it be improved easily by passing a bit more information via the `fields` config.

#### Setting a pretty name

With the following configuration, validation messages will start with _Email address_ instead of _This field_:

```js
sk('form', 'init', {
  fields: {
    email: {
      prettyName: "Email address"
    }
  },
  // ...
});
```

#### Overriding error messages

If you want to go fully custom, you can do that too. The following will display the custom message provided if it fails the `required` validation.

```js
sk('form', 'init', {
  fields: {
    email: {
      prettyName: "Email address",
      errorMessages: {
        required: "Oops! You must provide an email address"
      }
    }
  },
  // ...
});
```

The following server-side validation types are currently available:

| Key                     | Description                                            |
| :---------------------- | :----------------------------------------------------- |
| `required`              | Requires a field to be non-blank                       |
| `emailFormat`           | Requires a field to be formatted like an email address |


### Email properties

If you have an email notifications configured for your form, you can customize the subject line and reply-to address using special fields:

- `_subject`
- `_replyto` or `email`

You can add `<input>` fields to your form to make these settable by the user or set them programmatically.

```js
sk('form', 'init', {
  data: {
    _subject: 'New contact submission'
  },
  // ...
});
```

### Callbacks

You can optionally hook into various points of the form lifecycle using callbacks. 

For example, suppose you want to track an analytics event every time a form is submitted successfully. It might look something like this:

```js
sk('form', 'init', {
  onSuccess: function(config, resp) {
    analytics.track('Form submitted', { 
      email: resp.data.email 
    });

    window.location.href = '/success';
  },
  // ...
})
```

Here are all the available callbacks:

| Key                     | Arguments                | Called...                                                    |
| :---------------------- | :----------------------- | :----------------------------------------------------------- |
| `onInit`                | config                   | When the form is initialized                                 |
| `onSubmit`              | config                   | Right before the form is submitted                           |
| `onSuccess`             | config, [response](#response-object) | When the form it submitted successfully          |
| `onError`               | config, errors           | When server-side validation causes the submission to fail    |
| `onFailure`             | config                   | When the HTTP request unexpectedly fails                     |

#### Response Object

The response object received by the `onSuccess` callback looks like this:

| Key                     | Type                     | Description                                                  |
| :---------------------- | :----------------------- | :----------------------------------------------------------- |
| `id`                    | String                   | The (unique) form submission id                              |
| `data`                  | Object                   | The form submission data                                     |

### Error rendering

The `renderErrors` function is responsible for clearing error messages for fields that don't have an errors _and_ rendering messages for ones that do have errors.

```js
sk('form', 'init', {
  renderErrors: function(config, errors) {
    // your own implementation
  },
  // ...
});
```

The default implementation looks for child elements with the `data-sk-error={field}` attribute and populates the `innerHTML` with the field's error message (or clears the `innerHTML` if there is no error).
